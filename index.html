<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Homograph Attack Demonstrator</title>
    <style>
        @import url('/homograph-attack-demonstrator/arial.ttf');
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        h1, h2 {
            text-align: center;
            color: #005a9c;
        }
        h3 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        .container {
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }
        .box {
            flex: 1;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #fff;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"] {
            width: 95%;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 1.2em;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .char-codes {
            word-wrap: break-word;
            font-family: monospace;
            background-color: #eee;
            padding: 10px;
            border-radius: 4px;
            min-height: 50px;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #eef7ff;
        }
        .similarity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .char-comparison {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
        .char-comparison .chars {
            font-size: 1.1em;
            white-space: nowrap;
        }
        .char-comparison .chars b {
            font-weight: bold;
        }
        .char-comparison .chars span {
            font-weight: normal;
        }
        .similarity-percent {
            font-size: 0.9em;
        }
        .perfect-match {
            background-color: #d4edda; /* Green */
        }
        .high-similarity {
            background-color: #fff3cd; /* Yellow */
        }
        .no-match {
            background-color: #f8d7da; /* Red */
        }
        .message {
            text-align: center;
            font-weight: bold;
            color: #d9534f;
            margin-top: 10px;
        }
        .overall-similarity {
            text-align: center;
            font-size: 1.2em;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            background-color: #d1e7fd;
        }
        .loader {
            text-align: center;
            font-size: 1.2em;
            color: #005a9c;
        }
    </style>
    <!-- Import opentype.js library from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>
</head>
<body>

    <h1>Advanced Homograph Attack Demonstrator</h1>
    <div id="loader" class="loader">Loading Font...</div>

    <div id="main-content" style="display: none;">
        <div class="container">
            <div class="box">
                <label for="text1">Text 1 (e.g., Latin "a")</label>
                <input type="text" id="text1" value="apple.com">
                <h2>Character Codes</h2>
                <div class="char-codes" id="char-codes1"></div>
            </div>
            <div class="box">
                <label for="text2">Text 2 (e.g., Cyrillic "a")</label>
                <input type="text" id="text2" value="Ð°pple.com">
                <h2>Character Codes</h2>
                <div class="char-codes" id="char-codes2"></div>
            </div>
        </div>

        <div class="results">
            <h2>Analysis</h2>
            <div id="message" class="message"></div>

            <div id="analysis-results-visual">
                <h3>Per-Character Visual Similarity (Vector Comparison)</h3>
                <div id="similarity-grid-visual" class="similarity-grid"></div>
                <div id="overall-similarity-visual" class="overall-similarity"></div>
            </div>

            <div id="analysis-results-code">
                <h3>Per-Character Code Comparison (Binary Match)</h3>
                <div id="similarity-grid-code" class="similarity-grid"></div>
                <div id="overall-similarity-code" class="overall-similarity"></div>
            </div>
        </div>
    </div>

    <script>
        let font;

        // Load the font file. Using a WOFF2 file for efficiency.
        opentype.load('/homograph-attack-demonstrator/arial.ttf', function(err, loadedFont) {
            if (err) {
                document.getElementById('loader').textContent = 'Error loading font: ' + err;
                return;
            }
            font = loadedFont;
            document.getElementById('loader').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            analyze();
        });

        function levenshteinDistance(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;
            const matrix = Array(b.length + 1).fill(null).map(() => Array(a.length + 1).fill(null));
            for (let i = 0; i <= a.length; i += 1) matrix[0][i] = i;
            for (let j = 0; j <= b.length; j += 1) matrix[j][0] = j;
            for (let j = 1; j <= b.length; j += 1) {
                for (let i = 1; i <= a.length; i += 1) {
                    const indicator = a[i - 1] === b[j - 1] ? 0 : 1;
                    matrix[j][i] = Math.min(
                        matrix[j][i - 1] + 1, // deletion
                        matrix[j - 1][i] + 1, // insertion
                        matrix[j - 1][i - 1] + indicator, // substitution
                    );
                }
            }
            return matrix[b.length][a.length];
        }

        function analyze() {
            if (!font) return;

            const text1 = document.getElementById('text1').value;
            const text2 = document.getElementById('text2').value;

            // Get all DOM elements
            const charCodes1Div = document.getElementById('char-codes1');
            const charCodes2Div = document.getElementById('char-codes2');
            const messageDiv = document.getElementById('message');
            const gridVisualDiv = document.getElementById('similarity-grid-visual');
            const overallVisualDiv = document.getElementById('overall-similarity-visual');
            const gridCodeDiv = document.getElementById('similarity-grid-code');
            const overallCodeDiv = document.getElementById('overall-similarity-code');

            // Display raw character codes
            charCodes1Div.textContent = Array.from(text1).map(c => c.charCodeAt(0)).join(' ');
            charCodes2Div.textContent = Array.from(text2).map(c => c.charCodeAt(0)).join(' ');

            // Clear previous results
            messageDiv.textContent = '';
            gridVisualDiv.innerHTML = '';
            overallVisualDiv.innerHTML = '';
            gridCodeDiv.innerHTML = '';
            overallCodeDiv.innerHTML = '';
            console.clear();

            if (text1.length !== text2.length) {
                messageDiv.textContent = "Texts have different lengths, cannot perform per-character analysis.";
                document.getElementById('analysis-results-visual').style.display = 'none';
                document.getElementById('analysis-results-code').style.display = 'none';
                return;
            }

            document.getElementById('analysis-results-visual').style.display = 'block';
            document.getElementById('analysis-results-code').style.display = 'block';

            let totalVisualSimilarity = 0;
            let identicalChars = 0;
            const charArray1 = Array.from(text1);
            const charArray2 = Array.from(text2);

            for (let i = 0; i < charArray1.length; i++) {
                const char1 = charArray1[i];
                const char2 = charArray2[i];

                // --- 1. Visual Similarity Analysis ---
                const glyph1 = font.charToGlyph(char1);
                const glyph2 = font.charToGlyph(char2);
                const path1 = glyph1.getPath(0, 0, 72).toPathData();
                const path2 = glyph2.getPath(0, 0, 72).toPathData();
                
                console.log(`Character Pair ${i+1}: '${char1}' vs '${char2}'`);
                console.log(`'${char1}' SVG Path:`, path1);
                console.log(`'${char2}' SVG Path:`, path2);
                
                const distance = levenshteinDistance(path1, path2);
                const maxLength = Math.max(path1.length, path2.length);
                const visualSimilarity = maxLength > 0 ? (1 - distance / maxLength) * 100 : 100;
                totalVisualSimilarity += visualSimilarity;

                const visualComparisonDiv = document.createElement('div');
                visualComparisonDiv.classList.add('char-comparison');
                visualComparisonDiv.innerHTML = `
                    <div class="chars"><b>${char1}</b><span> vs </span><b>${char2}</b></div>
                    <div class="similarity-percent">${visualSimilarity.toFixed(2)}% Similar</div>`;
                
                if (visualSimilarity === 100) visualComparisonDiv.classList.add('perfect-match');
                else if (visualSimilarity > 85) visualComparisonDiv.classList.add('high-similarity');
                else visualComparisonDiv.classList.add('no-match');
                gridVisualDiv.appendChild(visualComparisonDiv);

                // --- 2. Code Similarity Analysis ---
                const code1 = char1.charCodeAt(0);
                const code2 = char2.charCodeAt(0);
                const codeComparisonDiv = document.createElement('div');
                codeComparisonDiv.classList.add('char-comparison');
                let codeSimilarity = 0;

                if (code1 === code2) {
                    codeSimilarity = 100;
                    identicalChars++;
                    codeComparisonDiv.classList.add('perfect-match');
                } else {
                    codeComparisonDiv.classList.add('no-match');
                }
                
                codeComparisonDiv.innerHTML = `
                    <div class="chars"><b>${char1}</b><span> vs </span><b>${char2}</b></div>
                    <div class="similarity-percent">${codeSimilarity}% Match</div>`;
                gridCodeDiv.appendChild(codeComparisonDiv);
            }
            
            // Display overall results
            const avgVisualSimilarity = text1.length > 0 ? totalVisualSimilarity / text1.length : 0;
            overallVisualDiv.innerHTML = `<strong>Average Visual Similarity: ${avgVisualSimilarity.toFixed(2)}%</strong>`;
            
            const avgCodeSimilarity = text1.length > 0 ? (identicalChars / text1.length) * 100 : 0;
            overallCodeDiv.innerHTML = `<strong>Average Code Similarity: ${avgCodeSimilarity.toFixed(2)}%</strong>`;
        }

        document.getElementById('text1').addEventListener('input', analyze);
        document.getElementById('text2').addEventListener('input', analyze);
    </script>
</body>
</html>
